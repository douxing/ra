// Generated by CoffeeScript 1.7.1
var connect, dbOptions, dbURI, dbconnected, dbdisconnected, dberror, exports, fs, mongoose;

fs = require('fs');

mongoose = require('mongoose');

dbURI = {
  dev: 'mongodb://localhost/ra_dev',
  prod: 'mongodb://localhost/ra_prod'
};

dbOptions = {
  server: {
    socketOptions: {
      keepAlive: 1
    }
  }
};

connect = function(env) {
  return mongoose.connect(dbURI[env], dbOptions);
};

dbconnected = function() {
  return console.log('Database connected.');
};

dberror = function(err) {
  return console.log("Database error: " + err);
};

dbdisconnected = function(err) {
  console.log('Database disconnected.');
  return connect();
};

exports = module.exports = function(app, config) {
  var file, models_path, _i, _len, _ref, _results;
  mongoose.connection.on('connected', dbconnected);
  mongoose.connection.on('error', dberror);
  mongoose.connection.on('disconnected', dbdisconnected);
  connect(config.env);
  models_path = "" + config.root + "/server/models";
  _ref = fs.readdirSync(models_path);
  _results = [];
  for (_i = 0, _len = _ref.length; _i < _len; _i++) {
    file = _ref[_i];
    if (file.indexOf('.js') > 0) {
      _results.push(require("" + models_path + "/" + file));
    } else {
      _results.push(void 0);
    }
  }
  return _results;
};
